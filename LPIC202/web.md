<h1>Apache</h1>  


<h3>httpd</h3>  

サーバプログラム（デーモン）  
起動すると設定ファイルにあたる、  
httpd.conf（rhel10のデフォルトは/etc/httpd/conf/httpd.confだった）を読み込み、  
記載されているディレクティブに従って動作する。  
各ディレクティブはどのコンテキストで使用できるかが定められている。  

<h3>httpd.conf</h3>

・ディレクティブ  
設定ファイルの中でデーモンに動作の指示を与える。  

・HostnameLookups[on|off]  
ログに出力されるIPアドレスを逆引きしてホスト名にする。  
接続数が増えると負荷が高くなるため、通常はoff。  

MPM  
マルチプロセッシングモジュール  
apacheでクライアントのリクエストを並列処理する仕組み。  

prework（デフォルト）  
1つのリクエストに対して1つのプロセスがサービスを行う。  
worker  
1つのリクエストに対してプロセス内の1つのスレッドがサービスを行う。  

fastCGI  
CGIの改良版。  
外部アプリケーションをWEBサーバに接続するプログラムであったCGIだが、リクエストごとにプロセス生成していた。  
→一度動いているプログラムをしばらく待機させて、都度プロセス生成させる手間を省くことで、処理の高速化と負荷の軽減につなげる。  

<h4>バーチャルホスト</h4>  
一つのサーバで複数のWEBサイトを管理することができる。  
  
・名前ベースバーチャルホスト  
1台のpcに1つのipと複数のドメインを設定  

・IPベースバーチャルホスト  
1台のpcに複数のipと複数のドメインを設定  

・SNI(server name indication)  
SSL/TLSセッションハンドシェイク時に、クライアント側から接続したいホスト名を平文で伝達する。  
サーバからは適切な証明書を返すことができる。  
IPベースのバーチャルホストの場合は1つのIPにつき1つのドメインが割り当てられているが、名前ベースの場合は区別できない。  
また、SSL通信前ではどのホストとの通信かを判別するhttpヘッダを確認することができない。  
クライアント側もSNIに対応するブラウザでなければならない。（ほぼ対応している）  

<h4>認証</h4>

・BASIC認証とdigest認証  
apacheによるアクセス制限。アクセスのために予め登録しているユーザーネームとパスワードが必要。  
BASIC認証は認証情報のやりとりを平文で交わすので、盗聴されるリスクがあるが簡易的に利用できる。  
digest認証は認証情報のやりとりをハッシュ化している為、盗聴リスクがBASIC認証に比べて低い。  

